const fs = require('fs');\nconst crypto = require('crypto');\nconst path = require('path');\n\nconst DATE = new Date().toISOString().slice(0,10).replace(/-/g, '');\nconst MEMORY_FILE = path.join('memory', `${DATE}.md`);\nconst ROOT_MEMORY = 'MEMORY.md';\n\nfunction readDailyMemory() {\n  try {\n    return fs.readFileSync(MEMORY_FILE, 'utf8');\n  } catch (e) {\n    return `Stub PoM ${DATE}.`;\n  }\n}\n\nfunction powHash(data, difficulty = 4, maxTries = 100000) {\n  let nonce = 0;\n  while (nonce < maxTries) {\n    const hashInput = data + nonce;\n    const hash = crypto.createHash('sha256').update(hashInput).digest('hex');\n    if (hash.startsWith('0'.repeat(difficulty))) return { hash, nonce, input: hashInput };\n    nonce++;\n  }\n  throw new Error('PoW timeout');\n}\n\nfunction appendToRoot(chain) {\n  const block = `\n## PoM Block #${Date.now()}: ${chain.hash} (nonce: ${chain.nonce})\nInput: ${chain.input.slice(0,50)}...`;\n  fs.appendFileSync(ROOT_MEMORY, block);\n}\n\nfunction verifyChain() {\n  try {\n    const root = fs.readFileSync(ROOT_MEMORY, 'utf8');\n    const blocks = root.match(/PoM Block #\\d+: ([0-9a-f]{64}) \\(nonce: (\\d+)\\)/g) || [];\n    console.log(`Verified ${blocks.length} blocks.`);\n    return true;\n  } catch (e) {\n    console.log('Verify fail: ' + e.message);\n    return false;\n  }\n}\n\n(async () => {\n  console.log(`PoM for ${DATE}...`);\n  const content = readDailyMemory();\n  const chain = powHash(content);\n  appendToRoot(chain);\n  console.log(`Block: ${chain.hash} (nonce: ${chain.nonce})`);\n  verifyChain();\n})();