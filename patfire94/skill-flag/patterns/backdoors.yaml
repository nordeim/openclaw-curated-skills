# Backdoor & Malware Patterns
# Risk: CRITICAL (85-100)

patterns:
  - name: bash_reverse_shell
    regex: "bash\\s+-i\\s+>&?\\s*/dev/tcp/"
    risk: 100
    description: "Bash reverse shell"
    
  - name: nc_reverse_shell
    regex: "nc\\s+.*-e\\s+.*(ba)?sh"
    risk: 100
    description: "Netcat reverse shell"
    
  - name: python_reverse_shell
    regex: "socket\\.socket.*connect.*subprocess|pty\\.spawn"
    risk: 100
    description: "Python reverse shell pattern"
    
  - name: perl_reverse_shell
    regex: "perl.*socket.*exec|perl.*-e.*socket"
    risk: 100
    description: "Perl reverse shell"

  - name: eval_dynamic
    regex: "eval\\s*\\(\\s*[^\"')\\s]"
    risk: 85
    description: "eval() with dynamic content"
    
  - name: exec_dynamic
    regex: "exec\\s*\\(\\s*[^\"')\\s]"
    risk: 85
    description: "exec() with dynamic content"
    
  - name: subprocess_shell
    regex: "subprocess\\.(run|call|Popen).*shell\\s*=\\s*True"
    risk: 80
    description: "subprocess with shell=True"
    
  - name: os_system
    regex: "os\\.system\\s*\\("
    risk: 75
    description: "os.system() - prefer subprocess"
    
  - name: cron_creation
    regex: "(crontab|/etc/cron)"
    risk: 70
    description: "Cron job manipulation"
    
  - name: systemd_creation
    regex: "(/etc/systemd|systemctl\\s+(enable|start))"
    risk: 75
    description: "Systemd service manipulation"
    
  - name: bashrc_modification
    regex: ">>?\\s*.*\\.(bashrc|zshrc|profile)"
    risk: 80
    description: "Shell profile modification"
    
  - name: ssh_authorized_keys
    regex: "\\.ssh/authorized_keys"
    risk: 95
    description: "SSH authorized_keys modification"
    
  - name: base64_decode_exec
    regex: "base64\\s+(-d|--decode).*\\|\\s*(bash|sh|python|perl)"
    risk: 95
    description: "Base64 decoded and executed"
    
  - name: curl_pipe_bash
    regex: "curl.*\\|\\s*(ba)?sh"
    risk: 90
    description: "curl piped to shell"
    
  - name: wget_pipe_bash  
    regex: "wget.*-O\\s*-.*\\|\\s*(ba)?sh"
    risk: 90
    description: "wget piped to shell"
