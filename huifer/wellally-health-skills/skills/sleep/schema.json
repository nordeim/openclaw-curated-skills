{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wellallyhealth.com/schemas/sleep-tracker.json",
  "title": "SleepTracker",
  "description": "睡眠追踪的数据结构定义",
  "type": "object",
  "properties": {
    "sleep_tracking": {
      "type": "object",
      "properties": {
        "user_profile": {
          "type": "object",
          "properties": {
            "typical_bedtime": { "type": "string", "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$" },
            "typical_wake_time": { "type": "string", "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$" },
            "ideal_sleep_duration": { "type": "number", "minimum": 4, "maximum": 12 },
            "sleep_schedule": { "type": "string", "enum": ["regular", "irregular", "shift_work"] },
            "bedtime_routine_established": { "type": "boolean" },
            "risk_factors": { "type": "array", "items": { "type": "string" } }
          }
        },
        "baseline_metrics": {
          "type": "object",
          "properties": {
            "average_sleep_duration": { "type": "number" },
            "average_sleep_latency": { "type": "number" },
            "average_sleep_efficiency": { "type": "number" },
            "baseline_period_start": { "type": "string", "format": "date" },
            "baseline_period_end": { "type": "string", "format": "date" }
          }
        },
        "goals": { "type": "array", "items": { "type": "object" } },
        "statistics": {
          "type": "object",
          "properties": {
            "total_sleep_records": { "type": "integer" },
            "longest_streak_days": { "type": "integer" },
            "current_streak_days": { "type": "integer" }
          }
        }
      }
    },
    "sleep_records": {
      "type": "array",
      "description": "每日睡眠记录",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "date": { "type": "string", "format": "date" },
          "sleep_times": {
            "type": "object",
            "properties": {
              "bedtime": { "type": "string", "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$" },
              "sleep_onset_time": { "type": "string", "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$" },
              "wake_time": { "type": "string", "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$" },
              "out_of_bed_time": { "type": "string", "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$" }
            }
          },
          "sleep_metrics": {
            "type": "object",
            "properties": {
              "sleep_duration_hours": { "type": "number", "minimum": 0, "maximum": 24 },
              "time_in_bed_hours": { "type": "number" },
              "sleep_latency_minutes": { "type": "number", "minimum": 0 },
              "sleep_efficiency": { "type": "number", "minimum": 0, "maximum": 100 },
              "sleep_debt": { "type": "number" }
            }
          },
          "sleep_stages": {
            "type": "object",
            "properties": {
              "light_sleep_hours": { "type": "number" },
              "deep_sleep_hours": { "type": "number" },
              "rem_sleep_hours": { "type": "number" },
              "awake_hours": { "type": "number" }
            }
          },
          "awakenings": {
            "type": "object",
            "properties": {
              "count": { "type": "integer", "minimum": 0 },
              "total_duration_minutes": { "type": "number", "minimum": 0 },
              "causes": { "type": "array", "items": { "type": "string" } }
            }
          },
          "sleep_quality": {
            "type": "object",
            "properties": {
              "subjective_quality": {
                "type": "string",
                "enum": ["excellent", "very_good", "good", "fair", "poor", "very_poor"]
              },
              "quality_score": { "type": "integer", "minimum": 1, "maximum": 10 },
              "rested_feeling": {
                "type": "string",
                "enum": ["not_at_all", "slightly", "somewhat", "quite", "very"]
              },
              "morning_mood": {
                "type": "string",
                "enum": ["very_tired", "tired", "neutral", "energized", "very_energized"]
              }
            }
          },
          "factors": {
            "type": "object",
            "properties": {
              "caffeine_after_2pm": { "type": "boolean" },
              "alcohol": { "type": "boolean" },
              "exercise": { "type": "boolean" },
              "screen_time_before_bed_minutes": { "type": "number" },
              "stress_level": { "type": "string", "enum": ["low", "medium", "high"] },
              "nap_duration_minutes": { "type": "number" }
            }
          },
          "notes": { "type": "string" }
        }
      }
    },
    "sleep_assessments": {
      "type": "object",
      "properties": {
        "psqi": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "date": { "type": "string", "format": "date" },
              "components": {
                "type": "object",
                "properties": {
                  "subjective_quality": { "type": "integer", "minimum": 0, "maximum": 3 },
                  "sleep_latency": { "type": "integer", "minimum": 0, "maximum": 3 },
                  "sleep_duration": { "type": "integer", "minimum": 0, "maximum": 3 },
                  "sleep_efficiency": { "type": "integer", "minimum": 0, "maximum": 3 },
                  "sleep_disturbances": { "type": "integer", "minimum": 0, "maximum": 3 },
                  "hypnotic_use": { "type": "integer", "minimum": 0, "maximum": 3 },
                  "daytime_dysfunction": { "type": "integer", "minimum": 0, "maximum": 3 }
                }
              },
              "total_score": { "type": "integer", "minimum": 0, "maximum": 21 },
              "interpretation": {
                "type": "string",
                "enum": ["good", "fair", "poor"]
              }
            }
          }
        },
        "epworth": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "date": { "type": "string", "format": "date" },
              "responses": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "situation": { "type": "string" },
                    "score": { "type": "integer", "minimum": 0, "maximum": 3 }
                  }
                }
              },
              "total_score": { "type": "integer", "minimum": 0, "maximum": 24 },
              "interpretation": {
                "type": "string",
                "enum": ["normal", "mild", "moderate", "severe"]
              }
            }
          }
        },
        "isi": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "date": { "type": "string", "format": "date" },
              "total_score": { "type": "integer", "minimum": 0, "maximum": 28 },
              "interpretation": {
                "type": "string",
                "enum": ["no_clinical_insomnia", "mild", "moderate", "severe"]
              }
            }
          }
        }
      }
    },
    "sleep_problems": {
      "type": "object",
      "properties": {
        "insomnia": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["onset", "maintenance", "mixed", "early_awakening", "none"]
            },
            "severity": { "type": "string", "enum": ["mild", "moderate", "severe"] },
            "duration": { "type": "string" }
          }
        },
        "sleep_apnea": {
          "type": "object",
          "properties": {
            "risk_level": { "type": "string", "enum": ["low", "moderate", "high"] },
            "stop_bang_score": { "type": "integer", "minimum": 0, "maximum": 8 },
            "snoring": { "type": "string", "enum": ["none", "mild", "moderate", "severe"] }
          }
        },
        "rls": {
          "type": "object",
          "properties": {
            "presence": { "type": "boolean" },
            "severity": { "type": "string", "enum": ["mild", "moderate", "severe"] }
          }
        }
      }
    },
    "sleep_hygiene": {
      "type": "object",
      "properties": {
        "environment": {
          "type": "object",
          "properties": {
            "temperature": { "type": "number", "description": "理想18-22℃" },
            "lighting": { "type": "string", "enum": ["dark", "dim", "bright"] },
            "noise": { "type": "string", "enum": ["quiet", "moderate", "loud"] },
            "mattress": { "type": "string", "enum": ["good", "fair", "poor"] },
            "pillow": { "type": "string", "enum": ["good", "fair", "poor"] }
          }
        },
        "habits": {
          "type": "object",
          "properties": {
            "screen_time_before_bed": { "type": "number", "description": "分钟" },
            "caffeine_cutoff": { "type": "string", "description": "下午时间" },
            "exercise_time": { "type": "string", "enum": ["morning", "afternoon", "evening", "none"] },
            "routine_consistency": { "type": "string", "enum": ["consistent", "inconsistent", "none"] }
          }
        },
        "score": { "type": "integer", "minimum": 0, "maximum": 10 }
      }
    }
  }
}
