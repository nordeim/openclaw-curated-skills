{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wellallyhealth.com/schemas/hospital-visit.json",
  "title": "HospitalVisitPreparation",
  "description": "医院就诊准备和健康摘要的数据结构定义",
  "type": "object",
  "properties": {
    "preparation_id": {
      "type": "string",
      "description": "准备记录唯一标识符",
      "pattern": "^prep_[0-9]{17}$"
    },
    "preparation_date": {
      "type": "string",
      "format": "date-time",
      "description": "准备生成时间"
    },
    "visit_target": {
      "type": "object",
      "description": "就诊目标",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["symptom", "department", "exam", "general"],
          "description": "目标类型"
        },
        "input": {"type": "string"},
        "recommended_department": {
          "type": "string",
          "description": "推荐科室"
        },
        "department_code": {
          "type": "string",
          "description": "科室代码"
        },
        "urgency": {
          "type": "string",
          "enum": ["emergency", "urgent", "routine"],
          "description": "紧急程度"
        }
      }
    },
    "health_summary": {
      "type": "object",
      "description": "健康数据摘要",
      "properties": {
        "basic_info": {
          "type": "object",
          "properties": {
            "age": {"type": "integer"},
            "blood_type": {
              "type": "string",
              "enum": ["A", "B", "AB", "O", "unknown"]
            }
          }
        },
        "allergies": {
          "type": "array",
          "description": "过敏史重点提示 (最多3条)",
          "items": {
            "type": "object",
            "properties": {
              "allergen": {"type": "string"},
              "severity": {
                "type": "string",
                "enum": ["mild", "moderate", "severe", "anaphylaxis"]
              },
              "reaction": {"type": "string"}
            }
          }
        },
        "recent_symptoms": {
          "type": "array",
          "description": "最近症状 (7天内)",
          "items": {
            "type": "object",
            "properties": {
              "date": {"type": "string", "format": "date"},
              "symptom": {"type": "string"},
              "severity": {"type": "string"},
              "duration": {"type": "string"}
            }
          }
        },
        "current_medications": {
          "type": "array",
          "description": "正在用药",
          "items": {
            "type": "object",
            "properties": {
              "name": {"type": "string"},
              "dosage": {"type": "string"},
              "frequency": {"type": "string"}
            }
          }
        },
        "recent_tests": {
          "type": "array",
          "description": "最近检查 (30天内)",
          "items": {
            "type": "object",
            "properties": {
              "date": {"type": "string", "format": "date"},
              "type": {"type": "string"},
              "key_findings": {"type": "string"}
            }
          }
        },
        "recent_diagnoses": {
          "type": "array",
          "description": "最近诊断",
          "items": {
            "type": "object",
            "properties": {
              "date": {"type": "string", "format": "date"},
              "diagnosis": {"type": "string"}
            }
          }
        },
        "upcoming_follow_ups": {
          "type": "array",
          "description": "待复查项目",
          "items": {
            "type": "object",
            "properties": {
              "item": {"type": "string"},
              "due_date": {"type": "string", "format": "date"}
            }
          }
        }
      }
    },
    "checklist": {
      "type": "object",
      "description": "就诊准备清单",
      "properties": {
        "essential_documents": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "item": {"type": "string"},
              "required": {"type": "boolean"},
              "checked": {"type": "boolean"}
            }
          }
        },
        "materials": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "item": {"type": "string"},
              "required": {"type": "boolean"},
              "checked": {"type": "boolean"}
            }
          }
        },
        "preparation_tips": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "department_info": {
      "type": "object",
      "description": "科室信息 (如有)",
      "properties": {
        "name": {"type": "string"},
        "description": {"type": "string"},
        "common_exams": {
          "type": "array",
          "items": {"type": "string"}
        },
        "preparation_notes": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    }
  },
  "required": ["preparation_id", "preparation_date", "health_summary"],
  "additionalProperties": false
}
