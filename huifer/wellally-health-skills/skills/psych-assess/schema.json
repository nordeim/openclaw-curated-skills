{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://wellallyhealth.com/schemas/psych-assessment.json",
  "title": "PsychAssessment",
  "description": "心理健康评估记录",
  "type": "object",
  "required": ["id", "assessment_type", "created_at", "assessment_date", "assessment_time", "scales", "risk_stratification"],
  "properties": {
    "id": {
      "type": "string",
      "description": "唯一标识符，格式：psych_YYYYMMDDHHMMSS_XXX"
    },
    "assessment_type": {
      "type": "string",
      "enum": ["full", "quick", "followup"],
      "description": "评估类型"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "创建时间（ISO 8601）"
    },
    "assessment_date": {
      "type": "string",
      "format": "date",
      "description": "评估日期（YYYY-MM-DD）"
    },
    "assessment_time": {
      "type": "string",
      "pattern": "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",
      "description": "评估时间（HH:MM）"
    },
    "baseline": {
      "type": "object",
      "description": "基线信息（全面评估）",
      "properties": {
        "reason_for_assessment": {
          "type": "string",
          "description": "评估原因"
        },
        "recent_life_changes": {
          "type": "array",
          "items": {"type": "string"},
          "description": "近期生活变化"
        },
        "social_support": {
          "type": "object",
          "properties": {
            "has_support": {"type": "boolean"},
            "support_quality": {
              "type": "string",
              "enum": ["high", "moderate", "low"]
            },
            "support_types": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        },
        "user_goals": {
          "type": "array",
          "items": {"type": "string"},
          "description": "用户目标"
        }
      }
    },
    "scales": {
      "type": "object",
      "description": "量表评分",
      "properties": {
        "phq9": {
          "type": "object",
          "description": "PHQ-9 抑郁症状评估",
          "properties": {
            "administered": {"type": "boolean"},
            "raw_score": {"type": "integer", "minimum": 0, "maximum": 27},
            "total_score": {"type": "integer", "minimum": 0, "maximum": 27},
            "max_score": {"type": "integer", "const": 27},
            "severity": {
              "type": "string",
              "enum": ["none", "mild", "moderate", "moderately_severe", "severe"]
            },
            "severity_code": {
              "type": "string",
              "enum": ["none", "mild", "moderate", "moderate_severe", "severe"]
            },
            "item_responses": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "item": {"type": "integer", "minimum": 1, "maximum": 9},
                  "score": {"type": "integer", "minimum": 0, "maximum": 3},
                  "question": {"type": "string"}
                }
              }
            }
          }
        },
        "phq2": {
          "type": "object",
          "description": "PHQ-2 抑郁快速筛查",
          "properties": {
            "administered": {"type": "boolean"},
            "total_score": {"type": "integer", "minimum": 0, "maximum": 6},
            "max_score": {"type": "integer", "const": 6},
            "severity": {"type": "string", "enum": ["negative", "positive"]}
          }
        },
        "gad7": {
          "type": "object",
          "description": "GAD-7 焦虑症状评估",
          "properties": {
            "administered": {"type": "boolean"},
            "raw_score": {"type": "integer", "minimum": 0, "maximum": 21},
            "total_score": {"type": "integer", "minimum": 0, "maximum": 21},
            "max_score": {"type": "integer", "const": 21},
            "severity": {
              "type": "string",
              "enum": ["minimal", "mild", "moderate", "severe"]
            },
            "severity_code": {
              "type": "string",
              "enum": ["minimal", "mild", "moderate", "severe"]
            },
            "item_responses": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "item": {"type": "integer", "minimum": 1, "maximum": 7},
                  "score": {"type": "integer", "minimum": 0, "maximum": 3},
                  "question": {"type": "string"}
                }
              }
            }
          }
        },
        "gad2": {
          "type": "object",
          "description": "GAD-2 焦虑快速筛查",
          "properties": {
            "administered": {"type": "boolean"},
            "total_score": {"type": "integer", "minimum": 0, "maximum": 6},
            "max_score": {"type": "integer", "const": 6},
            "severity": {"type": "string", "enum": ["negative", "positive"]}
          }
        },
        "pss4": {
          "type": "object",
          "description": "PSS-4 知觉压力量表",
          "properties": {
            "administered": {"type": "boolean"},
            "raw_score": {"type": "integer", "minimum": 0, "maximum": 16},
            "total_score": {"type": "integer", "minimum": 0, "maximum": 16},
            "max_score": {"type": "integer", "const": 16},
            "severity": {
              "type": "string",
              "enum": ["low", "moderate", "high"]
            },
            "item_responses": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "item": {"type": "integer", "minimum": 1, "maximum": 4},
                  "score": {"type": "integer", "minimum": 0, "maximum": 4},
                  "question": {"type": "string"}
                }
              }
            }
          }
        },
        "who5": {
          "type": "object",
          "description": "WHO-5 幸福感指数",
          "properties": {
            "administered": {"type": "boolean"},
            "raw_score": {"type": "integer", "minimum": 0, "maximum": 25},
            "total_score": {"type": "integer", "minimum": 0, "maximum": 25},
            "max_score": {"type": "integer", "const": 25},
            "wellbeing": {
              "type": "string",
              "enum": ["poor", "moderate", "good"]
            },
            "item_responses": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "item": {"type": "integer", "minimum": 1, "maximum": 5},
                  "score": {"type": "integer", "minimum": 0, "maximum": 4},
                  "question": {"type": "string"}
                }
              }
            }
          }
        },
        "sleep_quality": {
          "type": "object",
          "description": "睡眠质量评估",
          "properties": {
            "administered": {"type": "boolean"},
            "duration_hours": {
              "type": "number",
              "minimum": 0,
              "maximum": 24,
              "description": "睡眠时长（小时）"
            },
            "latency_minutes": {
              "type": "integer",
              "minimum": 0,
              "description": "入睡时间（分钟）"
            },
            "night_awakenings": {
              "type": "integer",
              "minimum": 0,
              "description": "夜醒次数"
            },
            "quality_rating": {
              "type": "integer",
              "minimum": 1,
              "maximum": 5,
              "description": "主观质量（1=很好，5=很差）"
            },
            "composite_score": {
              "type": "integer",
              "minimum": 0,
              "maximum": 12,
              "description": "综合得分"
            },
            "max_score": {"type": "integer", "const": 12},
            "severity": {
              "type": "string",
              "enum": ["good", "moderate", "poor"]
            }
          }
        }
      }
    },
    "crisis_assessment": {
      "type": "object",
      "description": "危机评估",
      "properties": {
        "triggered": {
          "type": "boolean",
          "description": "是否触发危机评估"
        },
        "crisis_risk_level": {
          "type": "string",
          "enum": ["minimal", "low", "moderate", "high", "critical"],
          "description": "危机风险等级"
        },
        "enhanced_assessment": {
          "type": "object",
          "description": "增强危机评估",
          "properties": {
            "administered": {"type": "boolean"},
            "frequency_score": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "nullable": true
            },
            "intensity_score": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "nullable": true
            },
            "plan_specificity": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "nullable": true
            },
            "means_availability": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "nullable": true
            },
            "intent_strength": {
              "type": "integer",
              "minimum": 0,
              "maximum": 3,
              "nullable": true
            },
            "prior_attempts": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "nullable": true
            },
            "protective_factors": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        },
        "protective_factors": {
          "type": "array",
          "items": {"type": "string"},
          "description": "保护性因素"
        },
        "risk_factors": {
          "type": "array",
          "items": {"type": "string"},
          "description": "风险因素"
        },
        "immediate_danger": {
          "type": "boolean",
          "description": "是否有立即危险"
        }
      }
    },
    "risk_stratification": {
      "type": "object",
      "description": "风险分层",
      "properties": {
        "overall_risk": {
          "type": "string",
          "enum": ["minimal", "low", "moderate", "high", "critical"]
        },
        "primary_concerns": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "domain": {"type": "string"},
              "severity": {"type": "string"}
            }
          }
        },
        "strengths": {
          "type": "array",
          "items": {"type": "string"}
        },
        "recommended_action": {"type": "string"},
        "urgency": {"type": "string"},
        "urgency_code": {"type": "string"}
      }
    },
    "recommendations": {
      "type": "object",
      "description": "建议",
      "properties": {
        "immediate": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "priority": {"type": "string"},
              "action": {"type": "string"},
              "timeframe": {"type": "string"},
              "description": {"type": "string"}
            }
          }
        },
        "self_help": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "category": {"type": "string"},
              "recommendations": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          }
        },
        "follow_up_assessment": {
          "type": "object",
          "properties": {
            "recommended_interval": {"type": "string"},
            "next_assessment_date": {
              "type": "string",
              "format": "date"
            },
            "what_to_monitor": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        }
      }
    },
    "correlations": {
      "type": "object",
      "description": "数据关联",
      "properties": {
        "linked_mood_ids": {
          "type": "array",
          "items": {"type": "string"}
        },
        "linked_symptom_ids": {
          "type": "array",
          "items": {"type": "string"}
        },
        "linked_medication_ids": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "元数据",
      "properties": {
        "created_at": {"type": "string", "format": "date-time"},
        "last_updated": {"type": "string", "format": "date-time"},
        "assessment_duration_minutes": {
          "type": "number",
          "minimum": 0
        },
        "completed": {"type": "boolean"},
        "data_quality": {
          "type": "string",
          "enum": ["low", "moderate", "high"]
        },
        "user_engagement": {
          "type": "string",
          "enum": ["low", "moderate", "high"]
        }
      }
    }
  }
}
