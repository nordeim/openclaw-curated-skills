openapi: 3.0.3
info:
  title: TypeTex Public Compile API
  description: |
    Public API for compiling Typst and LaTeX documents to PDF.
    No authentication required.
  version: 1.0.0
  contact:
    name: TypeTex Support
    url: https://typetex.app

servers:
  - url: https://studio-intrinsic--typetex-compile-app.modal.run
    description: Production server

paths:
  /public/compile/health:
    get:
      summary: Health check
      operationId: healthCheck
      tags:
        - Health
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  service:
                    type: string
                    example: public-compile

  /public/compile/typst:
    post:
      summary: Compile Typst to PDF
      operationId: compileTypst
      tags:
        - Compilation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TypstCompileRequest'
            examples:
              simple:
                summary: Simple document
                value:
                  content: |
                    #set page(paper: "a4")

                    = Hello World

                    This is a Typst document.
                  main_filename: main.typ
              multifile:
                summary: Multi-file project
                value:
                  content: |
                    #import "template.typ": *
                    #show: doc
                    = Title
                  main_filename: main.typ
                  auxiliary_files:
                    template.typ: |
                      #let doc(body) = { body }
      responses:
        '200':
          description: Compilation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompileResponse'

  /public/compile/latex:
    post:
      summary: Compile LaTeX to PDF
      operationId: compileLatex
      tags:
        - Compilation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LatexCompileRequest'
            examples:
              simple:
                summary: Simple document
                value:
                  content: |
                    \documentclass{article}
                    \begin{document}
                    Hello World
                    \end{document}
                  main_filename: main.tex
      responses:
        '200':
          description: Compilation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CompileResponse'

components:
  schemas:
    TypstCompileRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          description: Main Typst source code content
        main_filename:
          type: string
          default: main.typ
          description: Name of the main Typst file
        auxiliary_files:
          type: object
          additionalProperties:
            type: string
          description: |
            Additional files needed for compilation.
            Keys are filenames, values are content (text) or base64-encoded (binary).

    LatexCompileRequest:
      type: object
      required:
        - content
      properties:
        content:
          type: string
          description: Main LaTeX source code content
        main_filename:
          type: string
          default: main.tex
          description: Name of the main LaTeX file
        auxiliary_files:
          type: object
          additionalProperties:
            type: string
          description: |
            Additional files needed for compilation.
            Keys are filenames, values are content or base64-encoded binary.

    CompileResponse:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          description: Whether compilation succeeded
        pdf_base64:
          type: string
          description: Base64-encoded PDF content (only present on success)
        error:
          type: string
          description: Error message (only present on failure)
        log_output:
          type: string
          description: Compilation log output (may be present on failure)
