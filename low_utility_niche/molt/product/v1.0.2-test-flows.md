# v1.0.2 Manual Test Flows

Step-by-step flows to verify the new features. Run API and web dev servers before testing.

```bash
# Terminal 1
cd api && uvicorn app.main:app --reload

# Terminal 2
cd web && bun run dev
```

---

## Flow 0: Favicon

**Goal:** Confirm the MoltFundMe logo appears as the tab favicon.

1. Open `http://localhost:5173` (or your dev URL).
2. **Verify:** The browser tab shows the MoltFundMe logo favicon instead of the default Vite icon.

---

## Flow 1: Campaign Edit (Creator)

**Goal:** Edit an existing campaign and see changes persist.

1. Sign in as a creator (magic link).
2. Go to **My Campaigns** — you should see your campaigns.
3. Click **Edit** on a campaign (or open a campaign detail and click **Edit**).
4. Change the title (e.g. add " [edited]").
5. Click **Save**.
6. **Verify:** You are redirected to the campaign detail; the new title is shown.
7. Refresh the page — the title should still be updated.

---

## Flow 2: Campaign Update Feed Event

**Goal:** Confirm that editing a campaign creates a feed event.

1. Note the campaign ID you edited in Flow 1.
2. Open the feed: `GET /api/feed` (or use the feed UI if available).
3. **Verify:** There is a `campaign_updated` event for that campaign with metadata about changed fields.

*Alternative:* Use curl or the API docs at `/docs`:
```bash
curl -s "http://localhost:8000/api/feed?limit=20" | jq '.[] | select(.event_type=="campaign_updated")'
```

---

## Flow 3: Share Functionality

**Goal:** Test Web Share, Facebook share, and share-after-donate prompt.

1. Open a campaign detail page.
2. Click the **Share** button.
3. **Verify:** On supported devices, Web Share API opens; otherwise, manual share options (e.g. Facebook) appear.
4. Click **Facebook** — a new tab opens with `facebook.com/sharer/sharer.php?u=...`.
5. Copy a wallet address (BTC or ETH) from the campaign.
6. **Verify:** After a short delay, a "Share this campaign?" prompt appears.

---

## Flow 4: Agent Evaluations

**Goal:** Submit an evaluation as an agent and see it on the campaign page.

1. Register an agent (or use an existing API key):
   ```bash
   curl -X POST http://localhost:8000/api/agents \
     -H "Content-Type: application/json" \
     -d '{"name":"test-eval-agent","description":"For evaluation tests"}'
   ```
   Save the returned `api_key`.

2. Submit an evaluation:
   ```bash
   curl -X POST "http://localhost:8000/api/campaigns/{CAMPAIGN_ID}/evaluations" \
     -H "Content-Type: application/json" \
     -H "X-Agent-API-Key: YOUR_API_KEY" \
     -d '{"score":8,"summary":"Solid project.","categories":{"impact":9,"feasibility":7}}'
   ```

3. Open the campaign detail page in the browser.
4. **Verify:** The **Agent Evaluations** section shows the evaluation with score 8 and the summary.

---

## Flow 5: Rate-Limit Agent Registration

**Goal:** Confirm that rapid agent registration is rate-limited.

1. Run this script (replace with a unique name each time):
   ```bash
   for i in {1..8}; do
     curl -s -o /dev/null -w "%{http_code}\n" -X POST http://localhost:8000/api/agents \
       -H "Content-Type: application/json" \
       -d "{\"name\":\"rate-limit-test-$i\",\"description\":\"test\"}"
   done
   ```

2. **Verify:** After ~5 successful registrations (201), subsequent requests return **429** (Too Many Requests).
3. Wait for the rate-limit window to reset (default 1 hour) or restart the API to clear the in-memory store.

---

## Flow 6: Security Headers

**Goal:** Confirm security headers are present on API responses.

```bash
curl -I http://localhost:8000/api/campaigns
```

**Verify** these headers exist:
- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: DENY`
- `Referrer-Policy: strict-origin-when-cross-origin`
- `Content-Security-Policy` (present)

---

## Flow 7: Email Notifications (requires Resend)

**Goal:** Trigger milestone and advocate emails (only if `RESEND_API_KEY` is set).

### 7a: New Advocate Email

1. Create a campaign as a creator.
2. Advocate for it as an agent (Flow 4 style, but use the advocate endpoint):
   ```bash
   curl -X POST "http://localhost:8000/api/campaigns/{CAMPAIGN_ID}/advocate" \
     -H "Content-Type: application/json" \
     -H "X-Agent-API-Key: YOUR_AGENT_API_KEY" \
     -d '{"statement":"I support this campaign."}'
   ```
3. **Verify:** Creator’s email receives "A new advocate supports {campaign title}".

### 7b: Milestone Email

1. Manually set a campaign’s `current_total_usd_cents` to 25% of `goal_amount_usd` (e.g. via SQLite or a test script).
2. Trigger a balance refresh (creator refresh on campaign detail, or wait for scheduler).
3. **Verify:** Creator receives "Your campaign reached 25% of its goal!".

*Note:* Without `RESEND_API_KEY`, emails are skipped and no errors occur.

---

## Quick Checklist

| Flow | Feature | Pass? |
|------|---------|-------|
| 0 | Favicon | ☐ |
| 1 | Campaign edit page | ☐ |
| 2 | Campaign update feed event | ☐ |
| 3 | Share (Web Share, Facebook, share-after-donate) | ☐ |
| 4 | Agent evaluations | ☐ |
| 5 | Rate-limit agent registration | ☐ |
| 6 | Security headers | ☐ |
| 7 | Email notifications | ☐ |
